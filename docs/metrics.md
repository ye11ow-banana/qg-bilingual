# Метрики для QG/QА та їх нормалізація

## Нормалізація перед метриками
- `strip()` + конденсація пробілів, заміна небрейкінг-пробілів.
- Уніфікація лапок `"` і апострофа `’` до єдиного символу; пунктуація без дубль-пробілів.
- `lower()` застосовується лише в розрахунку метрик (не змінює артефакти).
- Токенізація: `str.split()` (white-space); знаки пунктуації залишаються окремими токенами після нормалізації.

## ROUGE-1/2/L [6]
- Вимірюють перекриття n-грам між гіпотезою і еталоном; ROUGE-1 — уніграми, ROUGE-2 — біграми.
- ROUGE-L: довжина LCS / довжина еталона; макро-усереднення по прикладах.
- Аггрегація: середнє (macro) precision/recall/F1 по кожному прикладу; основний звіт — F1.

## BLEU
- Геометричне середнє точності n-грам (1–4) з brevity penalty.
- Чутливий до перефразувань; для вільного формулювання питання використовувати як довідкову метрику.
- Нормалізація як вище; токенізація whitespace.

## QG→QA (EM/F1/pass-rate)
- **EM:** точний збіг нормалізованих відповідей: `EM(x) = 1[normalize(pred) == normalize(gold)]`.
- **Token-F1:** precision/recall на токенах; середнє макро по прикладах.
- **Pass-rate:** частка прикладів з F1 ≥ τ_f1 і conf ≥ τ_conf (за замовчуванням τ_f1=0.8<!--{{thresholds.f1_pass}}-->, τ_conf=0.35<!--{{thresholds.conf_pass}}-->) з [4].

```
EM(x) = 1[normalize(pred) == normalize(gold)]
F1(x) = 2 * (Precision * Recall) / (Precision + Recall)  # на токенах
pass(x) = 1[F1(x) ≥ τ_f1 ∧ conf(x) ≥ τ_conf]
```

## MOS
- Шкала 1–5; усереднення по анотаторах та прикладах для MOS.
- Інтер-оцінювальна узгодженість: κ Коена (2 анотатори) або α Кронбаха (≥3).
- 95% довірчий інтервал через bootstrap (див. нижче).

## Додаткові метрики
- **distinct-1/2:** унікальні уні-/біграми / загальна кількість токенів (лексична різноманітність).
- **BERTScore:** за потреби для контекстуально-залежних схожостей [4].
- **NLI-чек:** entailment/neutral/contradiction як фільтр якості, не як основна метрика.

## Порогові значення та цілі
- ROUGE-L: +5 п.п. відносно baseline (мінімальна мета).
- EM/F1: +5 п.п. відносно baseline.
- Pass-rate: ≥70% при τ_f1=0.8<!--{{thresholds.f1_pass}}-->, τ_conf=0.35<!--{{thresholds.conf_pass}}-->.
- MOS: ≥4.0; κ або α ≥0.6 для прийнятної узгодженості.

## Статистична значущість
- Paired bootstrap різниць Δ-метрик (ROUGE-L, EM, F1, pass-rate), 1000–5000 ресемплів.
- 95% CI; якщо інтервал не перетинає 0 — різниця значуща.
- Корекція на множинні порівняння: Benjamini–Hochberg (FDR 5%).

## Посилання
[1] T5 – https://arxiv.org/abs/1910.10683  
[2] BART – https://arxiv.org/abs/1910.13461  
[3] mT5 – https://arxiv.org/abs/2010.11934  
[4] Hugging Face Transformers – https://huggingface.co/docs/transformers  
[5] Hugging Face Datasets – https://huggingface.co/docs/datasets  
[6] ROUGE – https://aclanthology.org/W04-1013/
